<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHJH Chem</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="tsparticles"></div>

    <section class="hero-banner">
        <a href="/login" id="nav-login-btn" class="nav-login-link">
            <button class="filter-btn nav-btn-style">
                ğŸ‘¤ ç™»å…¥
            </button>
        </a>
        
        <div class="hero-content">
            <h1>æ•¦åŒ–åœ‹ä¸­è³‡å„ªç­åŒ–å­¸ç§‘ç‡ŸéšŠç¶²ç«™</h1>
            <p>è¬›å¸«ï¼šæ—å³»äº¨</p>
            <p>ç§‘å­¸ç­æº–å‚™</p>

            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨é¡¯ç¤º</button>
                <button class="filter-btn" data-filter="summer">æš‘æœŸç§‘å­¸ç‡Ÿ</button>
                <button class="filter-btn" data-filter="winter">å¯’å‡åŠ å¼·ç‡Ÿ</button>
                <button class="filter-btn" data-filter="mock">ç§‘å­¸ç­æº–å‚™</button>
            </div>
            <!--&#xe900; for language-switching icon-->
            <div class="subject-grid">
                <div class="subject-card" data-category="summer">
                    <span class="card-tag">æš‘æœŸ</span>
                    <div class="icon">&#9935;</div>
                    <h3>New features</h3>
                    <p>Building...</p> <!--(Game Zone)-->
                </div>

                <div class="subject-card" data-category="summer">
                    <span class="card-tag">æš‘æœŸ</span>
                    <div class="icon">&#128464;</div>
                    <h3>è©¦é¡Œè©³è§£</h3>
                    <p>è©³è§£å»ºè­°èˆ‡é›£åº¦åˆ†æ</p>
                </div>

                <div class="subject-card" onclick="handleTranscriptClick()" data-category="summer">
                    <span class="card-tag">æš‘æœŸ</span>
                    <div class="icon">ğŸ“Š</div>
                    <h3>æˆç¸¾æŸ¥è©¢</h3>
                    <p>å€‹äººæˆç¸¾èˆ‡æ’ååˆ†æ</p>
                </div>

                <div class="subject-card" data-category="winter">
                    <span class="card-tag">å¯’å‡</span>
                    <div class="icon">&#xe953;</div>
                    <h3>æ™‚é–“è¡¨</h3>
                    <p>ä¸Šèª²æ™‚ç¨‹èˆ‡èª²ç¨‹å®‰æ’</p>
                </div>

                <div class="subject-card" data-category="winter">
                    <span class="card-tag">å¯’å‡</span>
                    <div class="icon">&#128464;</div>
                    <h3>è©¦é¡Œè©³è§£</h3>
                    <p>ç­”å°ç‡åˆ†æèˆ‡ç·´ç¿’åº«</p>
                </div>

                <div class="subject-card" data-category="winter">
                    <span class="card-tag">å¯’å‡</span>
                    <div class="icon">&#xe99c;</div>
                    <h3>æˆç¸¾æŸ¥è©¢</h3>
                    <p>æ¸¬é©—çµæœèˆ‡æˆç¸¾æ’å</p>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/tsparticles-slim@2.0.6/tsparticles.slim.bundle.min.js"></script>
    <script src="script.js"></script>
    <script>
        // 1. Check if user is logged in
        function handleTranscriptClick() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));

            if (!currentUser) {
                // CASE A: Not logged in -> Go to Login Page
                alert("Please Login First");
                window.location.href = '/login';
            } else {
                downloadTranscript(currentUser);
            }
        }

        // 2. The Download Function (Same as before, but runs on Index)
        function downloadTranscript(user) {
            const username = user.username;
            const admission_year = user.admission_year;

            if (!admission_year) {
                alert("è³‡æ–™éŒ¯èª¤ï¼šç¼ºå°‘å…¥å­¸å¹´åº¦ (Missing Year)");
                return;
            }

            // Create hidden form to trigger download
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/get-transcript';

            const inputUser = document.createElement('input');
            inputUser.type = 'hidden';
            inputUser.name = 'username';
            inputUser.value = username;
            form.appendChild(inputUser);

            const inputYear = document.createElement('input');
            inputYear.type = 'hidden';
            inputYear.name = 'admission_year';
            inputYear.value = admission_year;
            form.appendChild(inputYear);

            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
        }
        
        // --- Update Navbar with Name ---
        document.addEventListener("DOMContentLoaded", () => {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const navBtn = document.getElementById('nav-login-btn');

            if (currentUser && navBtn) {
                const displayName = currentUser.name || currentUser.username;

                navBtn.innerText = `ğŸ‘¤ ${displayName}`;
                navBtn.href = "#";
                navBtn.onclick = function (e) {
                    e.preventDefault();
                    if (confirm(`Hi ${displayName}, ç¢ºå®šè¦ç™»å‡ºå—? (Log out?)`)) {
                        localStorage.removeItem('currentUser');
                        window.location.reload();
                    }
                };
            }
        });

        // --- Update Navbar with Username ---
        document.addEventListener("DOMContentLoaded", () => {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const navBtn = document.getElementById('nav-login-btn');

            if (currentUser && navBtn) {
                navBtn.innerText = `ğŸ‘¤ ${currentUser.name}`;

                // Optional: Make the button a "Logout" button
                navBtn.href = "#"; // Stop it from going to the login page
                navBtn.onclick = function (e) {
                    e.preventDefault();
                    // Ask to confirm logout
                    if (confirm(`Hi ${currentUser.username}, ç¢ºå®šè¦ç™»å‡ºå—? (Log out?)`)) {
                        localStorage.removeItem('currentUser'); // Delete saved login
                        window.location.reload(); // Refresh page to reset
                    }
                };
            }
        });

    </script>
</body>

</html>