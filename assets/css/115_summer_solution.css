/* =========================================
   1. GLOBAL LAYOUT
   ========================================= */
body {
    background: #F0ECE1;
    /* Off-white/Beige */
    color: #416361;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    margin: 0;
}

.container {
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
}


/* =========================================
   NEW: CONTROL PANEL (Top Right)
   ========================================= */
.control-panel {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 15px;
    align-items: center;
    background: white;
    padding: 10px 15px;
    border-radius: 30px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    z-index: 100;
}

.control-item {
    display: flex;
    align-items: center;
    font-size: 0.9rem;
    font-weight: bold;
    color: #416361;
}

/* Switch Toggle Style */
.switch {
    position: relative;
    display: inline-block;
    width: 40px;
    height: 20px;
    margin-left: 8px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 14px;
    width: 14px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked+.slider {
    background-color: #77A88D;
}

input:checked+.slider:before {
    transform: translateX(20px);
}


/* =========================================
   2. EXAM BLOCKS & HEADERS
   ========================================= */
.exam-block {
    margin-bottom: 30px;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(65, 99, 97, 0.1);
    /* Shadow using dark teal tint */
}

.block-header {
    background: #416361;
    color: #F0ECE1;
    padding: 15px 20px;
    font-size: 1.2rem;
    font-weight: bold;
}

/* =========================================
   3. PROBLEM ROW (SUMMARY VIEW)
   ========================================= */
.problem-summary {
    padding: 10px 20px;
    display: grid;
    grid-template-columns: 50px 1fr auto auto;
    gap: 15px;
    align-items: center;
    cursor: pointer;
    transition: background 0.2s;
    height: 70px;
}

.problem-row {
    border-bottom: 1px solid #BFB9B2;
    /* Greige border */
}

.problem-summary:hover {
    background-color: #C5E0DC !important;
}

/* Tags (Difficulty/Topic) */
.tag {
    font-size: 0.8rem;
    padding: 2px 8px;
    border-radius: 4px;
    background: #ECA594;
    /* Terracotta */
    color: white;
    margin-right: 5px;
    display: inline-block;
}

.stat-text {
    font-size: 0.85rem;
    color: #678F8D;
    /* Muted Teal */
    display: block;
    margin-top: 4px;
}

/* =========================================
   4. EXPANDED CONTENT & FIGURES
   ========================================= */
.problem-details {
    display: none;
    padding: 20px;
    background: #fafafa;
    border-top: 1px dashed #BFB9B2;
}

.question-text {
    font-size: 1.1rem;
    margin-bottom: 20px;
    font-weight: 500;
    line-height: 1.5;
    color: #333;
}

.problem-figure {
    margin: 15px 0;
    text-align: center;
}

.problem-figure img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
    border: 1px solid #BFB9B2;
    cursor: zoom-in;
    transition: transform 0.2s;
    background: white;
}

.problem-figure img:hover {
    transform: scale(1.02);
}


/* =========================================
   ANIMATION LOGIC (Stable Fix)
   ========================================= */

/* 1. Base State (Hidden) */
.problem-details,
.option-explanation {
    display: block !important;
    max-height: 0;
    opacity: 0;
    overflow: hidden;

    padding-top: 0 !important;
    padding-bottom: 0 !important;
    margin-top: 0 !important;
    border: none !important;

    /* Default: No animation */
    transition: none;
}

/* 2. Expanded State (Visible) */
.problem-details.expanded {
    max-height: 2000px;
    opacity: 1;
    padding: 20px !important;
    border-top: 1px dashed #BFB9B2 !important;
}

.option-explanation.expanded {
    max-height: 500px;
    opacity: 1;
    padding: 10px 15px !important;
    border-top: 1px solid #BFB9B2 !important;
    margin-top: 10px !important;
}

/* 3. The Animation (Applies to BOTH Open and Close) */
.animate-enabled .problem-details,
.animate-enabled .option-explanation {
    transition: all 0.3s linear(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
    0.0001, 0.0001, 0.0001, 0.0002, 0.0002, 0.0003, 0.0004, 0.0005, 0.0006, 0.0007, 
    0.0009, 0.0011, 0.0013, 0.0016, 0.0019, 0.0022, 0.0026, 0.0031, 0.0036, 0.0042, 
    0.0049, 0.0057, 0.0065, 0.0074, 0.0085, 0.0096, 0.0109, 0.0123, 0.0139, 0.0156, 
    0.0175, 0.0195, 0.0217, 0.0242, 0.0268, 0.0297, 0.0328, 0.0362, 0.0398, 0.0437, 
    0.0479, 0.0525, 0.0574, 0.0626, 0.0682, 0.0742, 0.0806, 0.0874, 0.0947, 0.1025, 
    0.1108, 0.1196, 0.1289, 0.1389, 0.1494, 0.1605, 0.1723, 0.1848, 0.1980, 0.2119, 
    0.2266, 0.2421, 0.2585, 0.2757, 0.2938, 0.3128, 0.3328, 0.3539, 0.3759, 0.3991, 
    0.4233, 0.4488, 0.4754, 0.5033, 0.5325, 0.5630, 0.5949, 0.6282, 0.6629, 0.6992, 
    0.7371, 0.7766, 0.8177, 0.8606, 0.9052, 0.9517, 1)
}

/* =========================================
   FILL-IN TEXT STYLES (Aligned)
   ========================================= */
.fill-summary-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
    /* Aligns text to the Left */

    /* CRITICAL FIX: Match the width of the Badge Grid (6 * 35px + gaps) */
    min-width: 240px;

    font-size: 0.85rem;
    line-height: 1.4;
}

.fill-line {
    display: flex;
    align-items: center;
    gap: 10px;
    /* More space between label and value */
    width: 100%;
}

.fill-label {
    font-weight: bold;
    color: #999;
    font-size: 0.75rem;
    text-transform: uppercase;
    width: 35px;
    /* Fixed width ensures numbers line up vertically */
    text-align: left;
}

/* General Explanation Box (Below the Question) */
.general-explanation {
    margin-top: 15px;
    padding: 15px;
    background: #F0ECE1;
    border-left: 4px solid #416361;
    border-radius: 4px;
    color: #2D4A48;
    line-height: 1.5;
}




/* =========================================
   5. OPTION ITEMS
   ========================================= */
.option-item {
    padding: 12px;
    margin: 8px 0;
    border: 1px solid #BFB9B2;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
    background: white;
    /* Default */
}

.option-item:hover {
    background-color: #E8E4D9;
}

/* --- CASE 1: TP / TN (Correctly Handled) ---
   "Light Beige" (Original: #F0ECE1, Lighter: #F8F5F0) */
.opt-tp,
.opt-tn {
    background-color: #F8F5F0 !important;
    border: 1px solid #BFB9B2;
}

/* --- CASE 2: FN (False Negative - Missed Correct Answer) ---
   "Green" */
.opt-fn {
    background-color: #C5E0DC !important;
    /* Light Teal/Green BG */
    border: 2px solid #77A88D !important;
    /* Sage Green Border */
}

/* --- CASE 3: FP (False Positive - Wrong Selection) ---
   "Red" */
.opt-fp {
    background-color: #FADBD8 !important;
    /* Light Red BG */
    border: 2px solid #E17055 !important;
    /* Terracotta Border */
}

.option-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
/* Percentage Bar Styling */
.option-bar-container {
    height: 6px;
    background: #e0e0e0;
    border-radius: 3px;
    margin-top: 8px;
    overflow: hidden;
}

.option-bar-fill {
    height: 100%;
    background-color: #BFB9B2;
    transition: width 1s ease-out;
}

/* If Answer Key includes this option (TP or FN) -> GREEN */
.bar-correct .option-bar-fill {
    background-color: #77A88D;
}

/* If Answer Key EXCLUDES this option (TN or FP) -> RED */
.bar-wrong .option-bar-fill {
    background-color: #E17055;
}

.opt-tp .option-explanation,
.opt-tn .option-explanation {
    background-color: #F8F5F0;
    border-top: 1px solid #BFB9B2;
}

.opt-fn .option-explanation {
    background-color: #C5E0DC;
    border-top: 1px solid #77A88D;
}

.opt-fp .option-explanation {
    background-color: #FADBD8;
    border-top: 1px solid #E17055;
}

/* =========================================
   6. MATRIX BADGES: TRUTH TABLE STYLES
   ========================================= */

.badge-container {
    display: grid;
    grid-template-columns: repeat(6, 35px);
    gap: 5px;
    justify-items: center;
}

/* Common Badge Shape */
.option-letter-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 35px;
    height: 35px;
    border-radius: 50%;

    font-family: Arial, sans-serif;
    font-size: 16px;
    font-weight: bold;
    line-height: 1;
    padding-top: 2px;

    box-sizing: border-box;
    margin: 0;
}

/* --- CASE (1,1): TRUE POSITIVE (Correct & Chosen) --- */
.case-tp {
    background-color: #77A88D;
    /* Sage Green */
    color: white;
    border: 2px solid #416361;
    /* Dark Teal Border */
    box-shadow: 0 2px 4px rgba(65, 99, 97, 0.3);
}

/* --- CASE (1,0): FALSE POSITIVE (Wrong & Chosen) --- */
.case-fp {
    background-color: #ECA594;
    /* Terracotta */
    color: white;
    border: 2px solid #416361;
    /* Dark Teal Border */
    box-shadow: 0 2px 4px rgba(65, 99, 97, 0.3);
}

/* --- CASE (0,1): FALSE NEGATIVE (Correct & Missed) --- */
.case-fn {
    background-color: #ECA594;
    /* Terracotta */
    color: rgba(255, 255, 255, 0.5);
    border: none;
}

/* --- CASE (0,0): TRUE NEGATIVE (Wrong & Ignored) --- */
.case-tn {
    background-color: #77A88D;
    /* Sage Green */
    color: rgba(255, 255, 255, 0.5);
    border: none;
}

/* Invisible placeholder */
.badge-placeholder {
    width: 35px;
    height: 35px;
    display: inline-block;
    visibility: hidden;
}

/* =========================================
   7. SQUARE SCORE BOX
   ========================================= */

.score-box {
    position: relative;
    /* Allows corner positioning */
    width: 50px;
    height: 50px;
    border-radius: 8px;
    background: #F0ECE1;
    border: 1px solid #BFB9B2;
    color: #416361;

    /* Center the Big Number */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* The Big Score (Centered) */
.score-val {
    font-size: 1.6rem;
    font-weight: bold;
    line-height: 1;
    margin-bottom: 5px;
    /* Slight lift to make room for corner text */
}

/* The Allocation (Bottom Right Corner) */
.score-alloc {
    position: absolute;
    bottom: 2px;
    right: 4px;
    font-size: 0.7rem;
    color: inherit;
    /* Inherit color from parent status */
    font-weight: normal;
    opacity: 0.8;
}

/* Color overrides */
.score-perfect {
    background: #C5E0DC;
    border: 2px solid #77A88D;
    color: #2D4A48;
}

.score-zero {
    background: #FADBD8;
    border: 2px solid #E17055;
    color: #C0392B;
}

.score-partial {
    background: #FFF3CD;
    border: 2px solid #F1C40F;
    color: #7D6608;
}


/* =========================================
   EXPLANATION TOGGLE (Fixing the Disappearance)
   ========================================= */
.option-explanation {
    display: none;
    /* Hidden by default */
    padding: 10px 15px;
    margin-top: 10px;
    background: #F0ECE1;
    color: #416361;
    font-size: 0.95rem;
    border-top: 1px solid #BFB9B2;
    border-radius: 0 0 4px 4px;
}

/* When the JavaScript adds this class, it will show */
.show-explanation .option-explanation {
    display: block;
}

/* =========================================
   BLOCK INTRO (Context Box)
   ========================================= */
.block-intro {
    padding: 20px;
    background: #ffffff;
    border-bottom: 3px solid #F0ECE1;
    /* Separator between intro and Q1 */
}

.intro-text {
    color: #444;
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 15px;
    text-align: justify;
}

/* If the intro has an image, reuse the existing figure style */
.block-intro .problem-figure {
    margin: 10px 0;
}

/* =========================================
   SECTION INTRO (Interleaved Context)
   ========================================= */
.section-intro {
    padding: 15px 20px;
    background: #ffffff;
    border-bottom: 1px solid #eee;
    margin-top: 30px;
    margin-bottom: 0;
    border-radius: 8px 8px 0 0;
}

.section-intro .intro-text {
    margin-bottom: 10px;
    color: #555;
    font-size: 0.95rem;
    line-height: 1.6;
}

/* =========================================
   SUB-QUESTION FILL STYLES (Compact List)
   ========================================= */
.fill-sub-line {
    display: flex;
    align-items: center;
    font-size: 0.9rem;
    margin-bottom: 4px;
    /* Spacing between 27-1 and 27-2 */
    width: 100%;
}

.fill-sub-line:last-child {
    margin-bottom: 0;
}

/* The Label (e.g. "27-1") */
.sub-tag {
    background: #e0e0e0;
    color: #555;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
    margin-right: 10px;
    min-width: 40px;
    /* Aligns the answers vertically */
    text-align: center;
}

/* Small "You/Ans" labels for sub-questions */
.sub-label-tiny {
    font-size: 0.7rem;
    color: #999;
    margin-right: 4px;
    text-transform: uppercase;
}

/* Separator between User and Correct answer */
.sub-divider {
    color: #ccc;
    margin: 0 8px;
    font-size: 0.8rem;
}

/* =========================================
   MULTI-COLUMN LAYOUT (For >3 sub-questions)
   ========================================= */
.fill-grid-3 {
    display: grid;
    grid-auto-flow: column;
    grid-template-rows: repeat(3, auto);
    gap: 5px 30px;
    width: 100%;
    align-items: center;
}

/* Ensure individual lines fit well in the grid */
.fill-grid-3 .fill-sub-line {
    width: auto;
    margin-bottom: 0;
    white-space: nowrap;
}